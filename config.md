# Bedrock マルチモーダル対応設定ガイド

## Lambda環境変数の設定

以下の環境変数をLambda関数に設定してください：

### 必須設定
```
BEDROCK_MODEL_ID: arn:aws:bedrock:ap-northeast-1:123456789012:inference-profile/apac.anthropic.claude-3-5-sonnet-v2
```
※ 実際の推論プロファイルARNに置き換えてください

### オプション設定（Guardrail使用時）
```
GUARDRAIL_ID: gr-xxxxxxxxxxxxx
GUARDRAIL_VERSION: DRAFT (または 1, 2 など)
```

## サポートされるファイル形式

### 画像ファイル
- **形式**: PNG, JPEG, GIF, WebP
- **制限**: 
  - 各ファイル最大 3.75MB
  - 最大20枚まで同時アップロード可能
  - 最大解像度 8000×8000ピクセル

### ドキュメントファイル  
- **形式**: 
  - PDF (.pdf)
  - CSV (.csv)
  - Microsoft Word (.doc, .docx)
  - Microsoft Excel (.xls, .xlsx)
  - HTML (.html)
  - テキストファイル (.txt)
  - Markdown (.md)
- **制限**:
  - 各ファイル最大 4.5MB
  - 最大5ファイルまで同時アップロード可能
  - PDF: 最大100ページ

## 使用方法

1. **テキストのみの質問**
   - 通常通りメッセージを入力して送信

2. **ファイル付き質問**
   - クリップアイコンをクリック
   - ファイルを選択（複数選択可）
   - プレビューで確認
   - メッセージを入力（オプション）して送信

3. **ファイルの削除**
   - プレビューの×ボタンをクリックして削除

## 注意事項

1. **モデルバージョン**
   - Claude 3.5 Sonnet以降のモデルが必要
   - PDF対応はClaude 3.5 Sonnet (20240620) 以降

2. **API Gateway設定**
   - ペイロードサイズ制限: 10MB以上に設定推奨
   - タイムアウト: 30秒以上に設定推奨

3. **Lambda設定**
   - メモリ: 512MB以上推奨
   - タイムアウト: 30秒以上
   - 実行ロール: Bedrock InvokeModel権限が必要

## トラブルシューティング

### エラー: "環境変数 BEDROCK_MODEL_ID に推論プロファイル ARN を設定してください"
→ Lambda環境変数に正しい推論プロファイルARNを設定

### エラー: "サポートされていない画像/ドキュメント形式です"
→ サポートされているファイル形式を確認

### エラー: "ファイルサイズが制限を超えています"
→ 画像は3.75MB、ドキュメントは4.5MB以下に圧縮

### エラー: "画像は最大20枚まで" / "ドキュメントは最大5ファイルまで"
→ ファイル数を減らして再送信